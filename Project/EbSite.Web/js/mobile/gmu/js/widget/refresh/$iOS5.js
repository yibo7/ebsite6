(function(b,a,c){b.Refresh.register("iOS5",{_init:function(){var f=this,e=f._options,d=f.$el;d.css({overflow:"scroll","-webkit-overflow-scrolling":"touch"});e.topOffset=e["$upElem"]?e["$upElem"].height():0;e.iScroll=f._getiScroll();d.get(0).scrollTop=e.topOffset;d.on("touchstart touchmove touchend",a.proxy(f._eventHandler,f))},_changeStyle:function(d,h){var f=this,e=f._options,g=e.refreshInfo[d];f.origin(d,h);switch(h){case"loaded":g["$icon"].addClass("ui-refresh-icon");e._actDir="";break;case"beforeload":g["$label"].html("\u677e\u5f00\u7acb\u5373\u52a0\u8f7d");g["$icon"].addClass("ui-refresh-flip");break;case"loading":g["$icon"].removeClass().addClass("ui-loading");break}return f},_scrollStart:function(i){var h=this,g=h._options,f=g.topOffset,d=g.$upElem,k=h.$el.get(0),j=function(){clearTimeout(g.topOffsetTimer);if(d&&d.length&&k.scrollTop<=f&&!g._upRefreshed){k.scrollTop=f}};h.trigger("scrollstart",i);h._enableScroll()._bindScrollStop(k,j);g.maxScrollY=k.offsetHeight-k.scrollHeight;g._scrollFn=j;return h},_scrollMove:function(){var g=this,f=g._options,e=f.$upElem&&f.$upElem.length,i=f.$downElem&&f.$downElem.length,h=g.$el.get(0),d=f.threshold||5;g._scrollMove=function(q){var m=f.maxScrollY,p=h.scrollTop,j=f.lastMoveY||p,k=f._upRefreshed,l=f._downRefreshed,o=g._status("up"),n=g._status("down");if(e&&!o||i&&!n){return}f.iScroll.deltaY=p-j;if(n&&i&&!l&&-p<(m-d)){g._setMoveState("down","beforeload","pull")}else{if(n&&i&&l&&-p>(m-d)&&-p!==m){g._setMoveState("down","loaded","restore")}else{if(o&&e&&!k&&-p>d){g._setMoveState("up","beforeload","pull")}else{if(o&&e&&k&&-p<d&&p){g._setMoveState("up","loaded","restore")}}}}f.lastMoveY=p;f._moved=true;return g.trigger("scrollmove",q,p,p-j)};g._scrollMove.apply(g,arguments)},_scrollEnd:function(j){var g=this,f=g._options,k=g.$el.get(0),d=f.topOffset,h=f._actDir,i=f._restoreDir;if((i=="up"||k.scrollTop<=d)&&!h&&f._moved){g._options.topOffsetTimer=setTimeout(function(){a(k).off("scroll",f._scrollFn);k.scrollTop=d},800)}if(h&&g._status(h)){g._setStyle(h,"loading");g._loadingAction(h,"pull")}f._moved=false;return g.trigger("scrollend",j)},_enableScroll:function(){var d=this,f=d.$el.get(0),e=f.scrollTop;e<=0&&(f.scrollTop=1);if(e+f.offsetHeight>=f.scrollHeight){f.scrollTop=f.scrollHeight-f.offsetHeight-1}return d},_bindScrollStop:function(g,e){var f=this,d=a(g);d.off("scroll",f._options._scrollFn).on("scroll",a.debounce(100,function(){d.off("scroll",arguments.callee).one("scroll",e)},false));return f},_getiScroll:function(){var d=this,e=d.$el,f=e[0];return{el:f,deltaY:0,scrollTo:function(i,h,g){if(g){i=f.scrollTop+i}e.css({"-webkit-transition-property":"scrollTop","-webkit-transition-duration":i+"ms"});f.scrollTop=i},disable:function(g){g&&d.destroy();e.css("overflow","hidden")},enable:function(){e.css("overflow","scroll")}}},_setMoveState:function(d,h,g){var f=this,e=f._options;f._setStyle(d,h);e["_"+d+"Refreshed"]=g=="pull";e._actDir=g=="pull"?d:"";e._restoreDir=d=="up"&&g=="restore"?d:"";return f},_eventHandler:function(f){var d=this;switch(f.type){case"touchstart":d._scrollStart(f);break;case"touchmove":d._scrollMove(f);break;case"touchend":d._scrollEnd(f);break}},afterDataLoading:function(d){var f=this,e=f._options,d=d||e._actDir;e["_"+d+"Refreshed"]=false;d=="up"&&(f.$el.get(0).scrollTop=e.topOffset);return f.origin(d)}})})(gmu,gmu.$);